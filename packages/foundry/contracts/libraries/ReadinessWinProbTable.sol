// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

/// @notice Readiness win probability lookup table (4 lanes).
/// @dev Index order is all sorted tuples (a<=b<=c<=d) with a,b,c,d in [1..10], in nested-loop order.
/// Each entry is 8 bytes: 4x uint16 (basis points) in big-endian.
/// @dev This is a deployable contract (not a library) so `AnimalRace` doesn't exceed the 24KB size limit.
contract ReadinessWinProbTable {
    uint256 internal constant ENTRY_BYTES = 8;
    uint256 internal constant TABLE_LEN = 715;

    bytes internal constant TABLE = hex"099a0a0709ce09a0065906a1067613a10143014001392354000400070005270000040007000526ff000100010001270f0001000100012710000100010001271000010001000127100001000100012710047e04ae0ef90eeb010001080479208f00040007002526e000040007002626e0000100010002270d000100010001271000010001000127100001000100012710000100010001271000510052132e133e00020004024b24bf00020004024a24c000010001003726d9000100010002270e000100010002270e000100010002270e000100010001271000010001137b139500010001137713990001000106c920470001000100a4266c0001000100a5266b0001000100a6266a000100010001271000010001137713980001000106c920470001000100a4266c0001000100a5266b0001000100a6266a0001000100012710000100011375139b0001000104092307000100010409230700010001040a23060001000100012710000100011376139a00010001137f139100010001138a13860001000100072709000100011381138f00010001138a1386000100010007270900010001138a1386000100010007270900010001136c13a403480c110bdf0bd700d203fe03f01e5000030025002326c400030026002426c3000100020002270c0001000100012710000100010001271000010001000127100001000100012710004801c81273128d00020019024724ae0002001a024524af00010002003726d7000100010002270e000100010002270e000100010002270e0001000100012710000100051378139300010005137513960001000106c920470001000100a4266c0001000100a5266b0001000100a6266a000100010001271000010005137513960001000106c820470001000100a4266c0001000100a5266b0001000100a6266a0001000100012710000100011376139a00010001040a2306000100010409230700010001040a23060001000100012710000100011376139a00010001137f139100010001138a13860001000100072709000100011381138f00010001138a138600010001000727090001000113891387000100010007270900010001136c13a400210d190cd80cfd0002020601f823110002020701f5231200010039003226a5000100010002270d000100010002270d000100010002270d00010001000127100001008b133413510001008b132f13560001001606c120390001000100a4266c0001000100a5266b0001000100a6266a00010001000127100001008b133013550001001606c120390001000100a4266c0001000100a5266b0001000100a5266a000100010001271000010005137413970001000104092306000100010408230800010001040a23060001000100012710000100011376139a00010001137f139100010001138913870001000100072709000100011381138f00010001138a138600010001000727090001000113891387000100010007270900010001136c13a400010d210cf30cfc00010d220cf00cff0001057705551c440001009e009425de0001009e009525dc000100a0009625da000100010001271000010d230cef0cfe0001057805551c420001009e009425de0001009f009525dc000100a0009625da0001000100012710000102e6120212280001006a03ee22b70001006b03ed22b90001006b03ee22b6000100010001271000010015136c138f000100161375138500010015137f137c00010001000727090001001513761385000100151380137b000100010007270900010015137f137c000100010007270900010001136c13a400010d230cef0cfd0001057905561c420001009e009425de0001009f009525dc000100a0009625da0001000100012710000102e6120312280001006a03ee22b80001006b03ed22b90001006b03ee22b6000100010001271000010015136c138f000100161374138600010015137f137c00010001000727090001001513761385000100151380137b000100010007270900010015137f137c000100010007270900010001136c13a400010d310cf60cea0001037b0347204e0001037d0346204d0001037e0347204b00010001000127100001014712d412f50001014712de12eb0001014812e612e200010001000727090001014712df12eb0001014712e712e200010001000727090001014612e612e3000100010007270900010001136c13a400010d1f0cef0d0200010d210cf70cf900010d210cfd0cf2000100080006270200010d210cf60cf900010d200cff0cf2000100080006270200010d200cfd0cf3000100080006270200010001136b13a400010d210cf60cf800010d200cff0cf2000100080006270200010d210cfd0cf2000100080006270200010001136c13a400010d200cfd0cf2000100080006270200010001136c13a400010d090cfc0d0a09b009cb09d009c5037a035f03741cc200220024002326a700210025002226a8000100020001270c000100010001271000010001000127100001000100012710000100010001271001a3019711e211f4001800190250248f001800190251248e00010001003526d8000100010001270f000100010001270f000100010001270f0001000100012710000300031385138400030003138713820001000106cd20420001000100a726690001000100a726690001000100a92667000100010001271000030003138813810001000106cd20420001000100a726690001000100a726690001000100a82668000100010001271000010001137a139600010001041b22f500010001041c22f400010001042022f000010001000127100001000113981378000100011394137c00010001139713790001000100082708000100011394137c000100011396137a0001000100082708000100011396137a00010001000827080001000113aa136600ec0ccb0ca60cb3001001ec02042310001001ec0204230f00010037003226a5000100010001270f000100010001270f000100010001270f00010001000127100003008b1346133c0003008b1348133a0001001306c820350001000100a726680001000100a726690001000100a8266700010001000127100003008b134913390001001306c820340001000100a726680001000100a726690001000100a826680001000100012710000100041378139300010001041b22f500010001041c22f400010001042022f000010001000127100001000113981378000100011394137c00010001139713790001000100082708000100011394137c00010001139713790001000100082708000100011396137a00010001000827080001000113aa136600010cf10d110d0e00010cf00d150d0a0001056b056f1c360001008f009825ea00010090009725e900010091009925e7000100010001271000010cf00d160d0a0001056c056f1c350001008f009825ea00010090009725e900010091009825e70001000100012710000102cc121f12250001005d03fe22b50001005e03fe22b40001005f040222af000100010001271000010013138f136e00010013138b137200010013138d1370000100010008270800010013138a137300010013138d1370000100010008270800010013138c137100010001000827080001000113aa136600010cf00d160d0a0001056c056f1c350001008f009825e900010090009725e900010091009825e70001000100012710000102cc121f12240001005d03fe22b50001005e03fe22b40001005f040222af0001000100012710000100131390136e00010013138b137200010013138d1370000100010008270800010013138a137300010013138d1370000100010008270800010013138d137000010001000827080001000113aa136600010d0c0d060cfe00010350036020610001034e03612061000103510365205a00010001000127100001013c130012d40001013b12fc12d90001013b12fe12d700010001000827080001013b12fb12da0001013c12fe12d600010001000827080001013c12fd12d700010001000827080001000113aa136600010cfd0d1d0cf600010cfa0d1b0cfb00010cfe0d1c0cf6000100070008270200010cf80d1c0cfc00010cfd0d1c0cf7000100070008270200010cfd0d1b0cf800010007000827020001000113a9136600010cf80d1d0cfc00010cfd0d1c0cf7000100070008270200010cfd0d1b0cf800010007000827020001000113aa136500010cfc0d1c0cf800010007000827020001000113aa136500010d1a0d180cdf09c009d009cb09b401cc01be01b821cf01cd01be01b921cc00380030002f2679000100010001270e000100010001270e000100010001270e000100010001271000910081130112fd00910081130412fa0017001506ce201600010001009f267000010001009e267100010001009c2673000100010001271000910081130412fa0017001606ce201600010001009f267000010001009f267000010001009c26730001000100012710000500041382138500010001042b22e400010001042b22e400010001042a22e60001000100012710000100011399137700010001138d13830001000113881388000100010006270a00010001138c13840001000113881388000100010006270a0001000113881388000100010006270a0001000113791397003b0cf10cfc0ce8003a0cf10d000ce5000c056e056e1c280001008f009125f000010090009025f00001008e008e25f40001000100012710003a0cef0d020ce6000c056f056d1c280001008f009125f00001008f009025f00001008e008e25f40001000100012710000302cd121b122400010060040f22a1000100600410229f0001005f040f22a20001000100012710000100131390136d000100131384137a00010013137f137f000100010006270a000100131383137a00010013137f137f000100010006270a00010013137f137e000100010006270a00010001137a1396003a0cef0d020ce5000c056f056d1c290001008f009125f00001008f009025f00001008e008e25f40001000100012710000302cd121b122400010060040f22a000010060041022a00001005f040f22a20001000100012710000100131390136d000100131383137a00010013137f137f000100010006270a000100131383137a00010013137f137f000100010006270a00010013137f137e000100010006270a00010001137a139600010cfd0d0c0d060001036c0365203f00010369036420420001036c0364204000010001000127100001013d12f912d90001013b12ec12e80001013d12e712ec000100010006270a0001013b12ed12e80001013d12e712ec000100010006270a0001013d12e712ec000100010006270a00010001137a139600010cf90d140d0300010cf40d0b0d1100010cf20d0b0d13000100070006270300010cf40d0c0d1100010cf30d0a0d13000100070006270300010cf30d0b0d13000100070006270300010001137a139600010cf40d0c0d1000010cf40d0a0d13000100070006270300010cf30d0b0d13000100070006270300010001137a139600010cf30d0a0d13000100070006270300010001137a139600010ce30d0e0d1f09df09b409c009bd09e109b309bb09c104900481048719780085008e0084257a0085008d0084257a0086008d00872576000100010001271009e009b309bc09c1048f04800486197a0085008e0084257a0085008d008525790086008d00862576000100010001271002840275111d10fb005a006403e02272005b006403df2272005a006403e12271000100010001271000120016138b135d00130016138c135b0013001613851362000100010006270a00130016138b135c0013001613841363000100010005270b0013001613841363000100010005270b000100011379139709e009b309bc09c1048f04800486197b0085008e0084257a0085008d008525790086008d00862576000100010001271002830275111d10fb005a006303e02272005b006403df2272005a006403e12271000100010001271000120016138b135d00130016138c135b0013001613851362000100010006270a00130016138b135c0013001613841363000100010005270b0013001613841363000100010005270b0001000113791397018f0c810c900c6f0042034703512036004303480350203500430347035120350001000100012710000e014212ee12d1000f014312ef12cf000f014212e812d6000100010006270a000f014312ee12d0000f014312e712d7000100010005270b000f014312e712d8000100010005270b000100011379139700040d0e0d0a0cf300040d100d0b0cf000040d0e0d0b0cf3000100050006270600040d100d0b0cf100040d0d0d0a0cf5000100050005270600040d0c0d0a0cf60001000500052706000100011378139700040d100d0b0cf100040d0c0d0a0cf5000100050005270600040d0c0d090cf60001000500052706000100011378139700040d0c0d090cf60001000500052706000100011378139700010d010d070d0809ac09e109b409cf048c049b0472197700830090008a257300810091008b257300810093008c257000010001000127100282029810ec110a005b006403d4227d005a006503d3227f005a006503d5227c0001000100012710001200151363138700120015136c137e0012001513761374000100010007270900120015136d137c001200151377137300010001000727090011001513761374000100010007270900010001136c13a4018d0cac0c710c660044036e03362028004303710335202700430371033620260001000100012710000e014412ce12ef000e014412d912e6000e014512e012dd0001000100072709000e014412d912e5000e014412e212dc0001000100072709000e014412e112de000100010007270900010001136c13a400070d1c0ced0d0000070d1e0cf40cf700070d1f0cfb0cf0000100080006270200070d1f0cf40cf600070d1e0cfc0cef000100080006270200060d1e0cfb0cf1000100080006270200010001136c13a400070d1f0cf40cf600070d1e0cfd0cef000100080006270200060d1e0cfb0cf0000100080006270200010001136c13a400060d1e0cfb0cf0000100080006270200010001136c13a400010d090cfc0d0a09bb09b509d609ca02e502ca02ed1e7502e402ca02ed1e7502e202cc02f21e70000100010001271001210122127d1250012301211279125301220122127c12510001000100082708012201211279125401210122127c1251000100010008270801220122127b125100010001000827080001000113aa136600890ccc0cf30cc8008b0cc80cf10ccc00890cce0cf20cc70001000700082702008a0cc60cf30ccd008a0ccc0cf20cc80001000700082702008a0ccc0cf10cc900010007000827020001000113a91366008a0cc60cf30ccd00890ccc0cf20cc80001000700082702008a0ccc0cf10cc900010007000827020001000113aa1365008a0ccb0cf20cc900010007000827020001000113aa136500010d1a0d180cdf09b509b309e109c709b909af09d909cf09be09ab09d909ce00060007000626fd09b909b009da09cd09be09ab09d809cf00060007000626fd09be09ab09d809cf00060007000626fd000100011379139609b909b009da09cd09be09ab09d809cf00060007000626fd09bf09aa09d809cf00060007000626fd00010001137a139509bf09ab09d809cf00060007000626fd000100011379139600010ce30d0e0d1f09e109c109b709b809e309be09b609b9000500050005270109e409bd09b509ba0005000500052701000100011378139709e409bd09b509ba0005000500052701000100011378139700010d010d070d08099009ee09cb09c700060008000626fc00010001136c13a400010d090cfc0d0a09b609d409e509a0";

    function _indexSorted(uint8 a, uint8 b, uint8 c, uint8 d) private pure returns (uint256 idx) {
        // Rank in nested-loop order without brute-forcing all 715 entries.
        // Count of nondecreasing length-r sequences from [s..10] is C((10-s+1)+r-1, r).
        if (a < 1 || d > 10) revert("ReadinessWinProbTable: bad tuple");
        if (a > b || b > c || c > d) revert("ReadinessWinProbTable: bad tuple");

        // sum_{i=1..a-1} C(10-i+3, 3)
        for (uint8 i = 1; i < a; i++) {
            idx += _c3(uint8(13 - i)); // C((10-i)+3,3) = C(13-i,3)
        }
        // sum_{j=a..b-1} C(10-j+2, 2)
        for (uint8 j = a; j < b; j++) {
            idx += _c2(uint8(12 - j)); // C(12-j,2)
        }
        // sum_{k=b..c-1} C(10-k+1, 1) = 11-k
        for (uint8 k = b; k < c; k++) {
            idx += uint256(11 - k);
        }
        // sum_{m=c..d-1} 1
        idx += uint256(d - c);
    }

    function _c2(uint8 n) private pure returns (uint256) {
        // n choose 2
        if (n < 2) return 0;
        return (uint256(n) * uint256(n - 1)) / 2;
    }

    function _c3(uint8 n) private pure returns (uint256) {
        // n choose 3
        if (n < 3) return 0;
        return (uint256(n) * uint256(n - 1) * uint256(n - 2)) / 6;
    }

    function getSorted(uint8 a, uint8 b, uint8 c, uint8 d) external pure returns (uint16[4] memory probsBps) {
        uint256 idx = _indexSorted(a, b, c, d);
        uint256 off = idx * ENTRY_BYTES;
        probsBps[0] = _u16be(off);
        probsBps[1] = _u16be(off + 2);
        probsBps[2] = _u16be(off + 4);
        probsBps[3] = _u16be(off + 6);
    }

    function _u16be(uint256 off) private pure returns (uint16 v) {
        // TABLE is a constant bytes, so bounds are guaranteed by construction.
        uint8 hi = uint8(TABLE[off]);
        uint8 lo = uint8(TABLE[off + 1]);
        v = (uint16(hi) << 8) | uint16(lo);
    }
}
