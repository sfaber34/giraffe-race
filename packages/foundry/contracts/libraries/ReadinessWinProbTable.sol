// SPDX-License-Identifier: MIT
pragma solidity ^0.8.19;

/// @notice Readiness win probability lookup table (4 lanes).
/// @dev Index order is all sorted tuples (a<=b<=c<=d) with a,b,c,d in [1..10], in nested-loop order.
/// Each entry is 8 bytes: 4x uint16 (basis points) in big-endian.
/// @dev This is a deployable contract (not a library) so `AnimalRace` doesn't exceed the 24KB size limit.
contract ReadinessWinProbTable {
    uint256 internal constant ENTRY_BYTES = 8;
    uint256 internal constant TABLE_LEN = 715;

    bytes internal constant TABLE = hex"099c09e909c509c6099709ed09c809c5099709f009c609c4099409eb09c809c9099c09e609c309cb099e09e409c109cd099f09e509bc09d0099709ea09c409cb099609ef09c709c400050008000626fd099609ed09c909c5099609f209c409c4099409eb09c809c9099c09e409c309cd099e09e509bf09ce099f09e509bb09d1099609eb09c309cc099509ef09c909c300050008000626fc099609f109c409c4099509eb09c809c9099d09e309c309cd099e09e409c009ce099d09e609bb09d2099709eb09c209cb099409ef09c909c400050008000626fc099409eb09c709c9099e09e409c109cd099e09e409be09cf099d09e509bd09d2099609eb09c509ca099309ef09c909c500050008000626fc09a009e409c009cc099d09e409be09d0099c09e409bd09d2099509ec09c509cb099109ef09ca09c600050008000626fc099d09e509bd09d1099a09e609bf09d1099409ec09c609cb099009ee09ca09c700050008000626fc099909e609c009d1099409ed09c509ca099009ee09cb09c600050008000626fc099409eb09c609cc098f09ee09cd09c600050008000626fc099009ee09cc09c600060008000626fc00010001136b13a4099609ed09c909c4099609f209c409c4099409ea09c809ca099c09e409c309cd099e09e509bf09ce099f09e609bb09d1099609eb09c309cc099509ef09c909c300050008000626fc099609f109c409c4099409eb09c809c9099d09e309c309cd099f09e409c009ce099d09e609bb09d2099709eb09c309cb099409ef09c909c400050008000626fc099409eb09c709c9099e09e309c109cd099e09e409be09d0099c09e409be09d2099609eb09c509ca099309f009c909c500050008000626fc09a009e409c009cc099d09e409be09d1099c09e509be09d2099509ec09c509cb099109ef09ca09c600050008000626fc099d09e509bd09d1099a09e609bf09d1099409ec09c609ca099009ef09ca09c700050008000626fc099a09e609c009d1099409ec09c509cb099009ee09cb09c600050008000626fc099409eb09c609cc098f09ee09cd09c600050008000626fc099009ee09cc09c700060008000626fc00010001136b13a4099609f109c409c4099509eb09c809c9099d09e409c309cd099e09e409bf09ce099c09e609bb09d2099709eb09c309cb099409ef09c909c400050008000626fc099509ec09c709c9099f09e409c109cd099e09e409bf09cf099d09e409be09d1099609eb09c509ca099309ef09c909c500050008000626fc09a009e309c009cc099d09e409be09d1099c09e509be09d2099509ec09c509cb099009ef09ca09c600050008000626fc099d09e509bd09d1099a09e609bf09d1099409ec09c509ca099009ef09ca09c700050008000626fc099909e609c009d1099409ec09c609cb099009ee09cb09c700050008000626fc099409eb09c609cb099009ed09cc09c600050008000626fc099009ee09cb09c700060008000626fc00010001136b13a4099509ec09c709c9099e09e409c109cd099f09e309be09d0099d09e409be09d1099609eb09c509ca099209ef09c909c500050008000626fc09a009e309c009cc099d09e409be09d1099b09e509be09d2099509ec09c409ca099109ef09ca09c600050008000626fc099d09e509bd09d1099a09e609bf09d2099409ec09c509ca099009ee09cb09c700050008000626fc099909e609c009d1099309ec09c609cb099009ee09cb09c700050008000626fc099409eb09c609cb099009ed09cc09c600050008000626fc099009ed09cb09c700060008000626fc00010001136b13a409a009e409c009cc099d09e409be09d1099b09e509be09d2099509ec09c509cb099109ef09ca09c600050008000626fc099d09e409bd09d2099a09e609bf09d2099409ec09c509ca099009ee09ca09c700050008000626fc099909e609c009d1099309ec09c609cb099009ee09cb09c700050008000626fc099409eb09c609cb099009ee09cc09c600050008000626fc099009ed09cb09c700060008000626fc00010001136b13a4099d09e409bd09d1099909e609bf09d2099409ec09c609ca099109ee09ca09c700050008000626fc099909e609c109d1099409ec09c609cb099009ee09cb09c700050008000626fc099509eb09c509cb099009ed09cd09c600050008000626fc099009ee09cb09c700060008000626fc00010001136b13a4099909e609c109d1099409ec09c609cb099009ee09cb09c700050008000626fc099509ec09c509ca099009ed09cd09c600050008000626fc099009ed09cb09c700060008000626fc00010001136b13a4099509ec09c509ca099009ed09cd09c600050008000626fc099009ee09cb09c700060008000626fc00010001136c13a4099009ee09cb09c700060008000626fc00010001136c13a400010d090cfc0d0a09b409c009cd09cf09b409c209c909d109b609bd09cd09cf09af09bf09d209d109aa09c109d809cd09ac09c109d709cd09ad09bd09da09cc09a909bf09de09ca00050007000726fd09b409c209c909d109b609bc09cd09d109af09bd09d309d109aa09c109d809ce09ac09c009d709cd09ac09bd09d909ce09a909be09de09cb00050007000726fd09b509bc09cb09d309ad09bf09d409d009a909c109d809ce09ac09bf09d809cd09ac09bc09da09ce09a809c009de09ca00050007000726fd09ad09bf09d509d009ab09bf09d809cd09ac09bf09d709ce09ab09bb09db09ce09a909bf09dd09cb00050007000826fd09ac09c009d809cd09ac09c009d709ce09ac09ba09db09ce09a909be09dd09cc00050007000826fd09ad09c009d709cc09ad09bb09da09cf09a909c009dd09ca00050007000826fd09ac09b909db09d009a809bf09dd09cc00050007000826fd09a609bf09dd09cd00050007000826fd0001000113a9136609b409c209c909d109b609bd09cd09d109af09bd09d309d109aa09c009d909cd09ac09c009d709cd09ac09bd09d909ce09a809be09de09cb00050007000726fd09b509bc09cb09d309ae09bf09d409d009a909c109d809ce09ac09bf09d809cd09ac09bc09db09ce09a809bf09de09ca00050007000726fd09ac09bf09d509d009ac09bf09d809cc09ac09bf09d709ce09ab09bb09db09ce09a909bf09dd09cb00050007000826fd09ac09c009d709cd09ac09c009d709cd09ad09ba09db09ce09a909bf09dd09cc00050007000826fd09ad09c009d709cc09ad09bb09da09cf09a909c009dd09ca00050007000826fd09ac09b809db09d009a809bf09dd09cc00050007000826fd09a609bf09dc09ce00050007000826fd0001000113a9136609b609bc09cb09d309ad09bf09d409d009a909c109d809ce09ac09bf09d809cd09ac09bb09db09ce09a809c009de09ca00050007000726fd09ac09bf09d509d009ac09bf09d909cd09ac09bf09d709ce09ab09bb09dc09ce09a909bf09dd09cb00050007000826fd09ab09c109d709cd09ac09c009d709cd09ad09bb09db09ce09a909bf09dd09cc00050007000826fd09ad09c009d709cc09ad09ba09da09cf09a909c009dd09ca00050007000826fd09ac09b809dc09d009a809bf09dd09cc00050007000826fd09a609bf09dc09ce00050007000826fd0001000113aa136609ac09bf09d509d009ac09bf09d909cd09ac09c009d709ce09ab09bb09dc09ce09a909bf09dd09cb00050007000826fd09ab09c009d709cd09ac09c109d709cd09ad09ba09da09ce09a809bf09dd09cc00050007000826fd09ad09c009d709cd09ad09ba09da09cf09a809c009dd09ca00050007000826fd09ac09b809db09d009a809bf09dd09cc00050007000826fd09a609bf09dd09ce00050007000826fd0001000113a9136609ab09c009d809cd09ac09c109d709cd09ad09ba09db09ce09a809bf09dd09cc00050007000826fd09ac09c009d709cd09ac09ba09da09cf09a809c009dd09cb00050007000826fd09ac09b809db09d009a809bf09dd09cc00050007000826fd09a609bf09dc09ce00050007000826fd0001000113aa136609ac09c009d709cd09ac09ba09da09d009a809c009dd09cb00050007000826fd09ac09b809db09d009a909bf09dd09cc00050007000826fd09a609bf09dc09ce00050007000826fd0001000113a9136609ac09b809dc09d009a909bf09dc09cc00050007000826fd09a709bf09dc09ce00050007000826fd0001000113aa136509a609bf09dd09ce00050007000826fd0001000113aa136500010d1a0d180cdf09b809b709d109cf09b809bb09d409c809b209ba09d509cf09b509b309dd09cb09b509b309dd09cb09bc09af09dc09c909ba09ac09da09d000060007000626fd09b809bb09d309ca09b009b909d809ce09b609b309dd09ca09b409b509de09c909bc09ae09dd09c909bc09ac09d809cf00060007000626fd09b109b809d909ce09b709b309dd09c909b409b409df09c909bb09ae09dc09cb09bc09ad09d809cf00060007000626fd09b709b209dd09ca09b609b309e009c809bb09af09d909cd09bd09ab09d909cf00060007000626fd09b409b409e109c709b909ae09d909cf09be09ab09d809cf00060007000626fd09b909af09d909ce09be09ab09d809cf00060007000626fd09bd09ab09d909cf00060007000626fd000100011379139609b809bb09d409ca09b009ba09d809ce09b609b309dd09ca09b409b509df09c909bb09ae09dd09ca09bc09ac09d809cf00060007000626fd09b109b809d909ce09b709b209dd09ca09b509b309df09c909bb09ae09dc09cb09bc09ad09d809cf00060007000626fd09b609b209dd09cb09b509b309e009c809bb09af09d909cd09bd09ab09d909cf00060007000626fd09b409b409e109c709b909ae09da09cf09be09ab09d809cf00060007000626fd09b909b009da09cd09be09ab09d809cf00060007000626fd09bd09ab09d909cf00060007000626fd000100011379139609b209b809d909cd09b709b209dd09ca09b509b309df09c909bb09af09db09cb09bc09ad09d809cf00060007000626fd09b609b209dd09cb09b509b309e009c709ba09af09d909cd09bd09ab09d909cf00060007000626fd09b409b409e109c709b909af09d909cf09be09ab09d809cf00060007000626fd09b909b009da09cd09be09ab09d809cf00060007000626fd09be09ab09d909cf00060007000626fd00010001137a139509b609b309dd09ca09b509b309e009c709bb09af09d909cd09bd09ac09d909ce00060007000626fd09b409b309e109c709b909af09d909cf09be09ab09d809cf00060007000626fd09b909af09da09cd09be09ab09d809cf00060007000626fd09be09ab09d909cf00060007000626fd000100011379139609b509b309e109c709b909af09d909cf09be09ab09d909cf00060007000626fd09b909af09da09ce09be09ab09d809cf00060007000626fd09be09ab09d809cf00060007000626fd000100011379139609b909b009da09cd09be09ab09d809cf00060007000626fd09bf09aa09d809cf00060007000626fd00010001137a139509bf09aa09d809cf00060007000626fd000100011379139600010ce30d0e0d1f09db09c409b209bf09de09be09b209c109e009c109b009bf09e409bd09b509bb09e109c209b609b709e009c109b609b8000500050006270109de09bf09b309bf09e009bf09b109c009e209be09b509bb09e009c209b609b809e209c109b609b7000500050006270109e009c109b109be09e209be09b509ba09e009c209b709b809e109c009b709b8000500050006270109e109bf09b609ba09e009c209b609b709e109be09b809b9000500050006270109e109c109b709b709e309bd09b709b9000500050005270109e309bd09b609b90005000500052701000100011378139709de09bf09b409bf09e009bf09b109c009e209be09b509ba09e009c209b609b809e209c109b709b7000500050006270109e009c109b109bf09e209bf09b509ba09e009c209b609b709e109bf09b709b8000500050006270109e109bf09b609ba09e009c209b609b709e109be09b809b8000500050006270109e109c109b609b809e409bd09b609b9000500050005270109e309bd09b609b90005000500052701000100011378139709df09c009b109bf09e209bf09b509ba09e109c209b609b709e109bf09b709b8000500050006270109e109be09b609ba09e009c209b709b709e209bf09b809b8000500050006270109e109c109b609b809e409bd09b709b8000500050005270109e309be09b609b90005000500052701000100011378139709e109bf09b609ba09e009c209b609b809e109bf09b809b8000500050006270109e109c109b609b809e409bd09b609b8000500050005270109e409bd09b609b90005000500052701000100011378139709e109c109b709b809e409bd09b609b9000500050005270109e409bd09b509b90005000500052701000100011378139709e409bd09b509ba0005000500052701000100011378139700010d010d070d0809a009e409c009cc099d09e409be09d1099b09e509be09d2099509ec09c409cb099109ef09ca09c600050008000626fc099d09e509bd09d1099a09e609bf09d2099409ec09c509cb099009ee09ca09c700050008000626fc099909e609c009d1099309ec09c609cb099009ee09cb09c700050008000626fc099409eb09c609cb099009ee09cc09c600050008000626fc099009ed09cb09c700060008000626fc00010001136b13a4099d09e409bd09d1099909e609bf09d2099409ec09c609cb099109ee09ca09c700050008000626fc099909e609c109d1099409ec09c609cb099009ee09cb09c700050008000626fc099509eb09c509cb099009ed09cd09c600050008000626fc099009ee09cb09c700060008000626fc00010001136b13a4099909e609c109d1099409eb09c609cb099009ee09cb09c700050008000626fc099509ec09c509ca099009ed09cd09c600050008000626fc099009ed09cb09c700060008000626fc00010001136b13a4099509ec09c509ca099009ed09cd09c600050008000626fc099009ee09cb09c700060008000626fc00010001136c13a4099009ee09cc09c700060008000626fc00010001136c13a400010d090cfc0d0a09ab09c009d809cd09ac09c109d709cd09ad09ba09da09ce09a809bf09dd09cc00050007000826fd09ac09c009d709cd09ac09ba09da09cf09a809c009dd09cb00050007000826fd09ac09b809db09d009a909bf09dd09cc00050007000826fd09a609bf09dc09ce00050007000826fd0001000113a9136609ac09c009d709cd09ad09ba09da09cf09a809c009dd09cb00050007000826fd09ac09b809db09d009a909bf09dd09cc00050007000826fd09a609bf09dc09ce00050007000826fd0001000113a9136609ac09b909db09d009a909bf09dc09cc00050007000826fd09a709bf09dc09ce00050007000826fd0001000113aa136509a609bf09dd09ce00050007000826fd0001000113aa136500010d1a0d180cdf09b509b309e109c709b909af09d909cf09be09ab09d909ce00060007000626fd09b909b009da09cd09be09ab09d809cf00060007000626fd09be09ab09d809cf00060007000626fd000100011379139609b909b009da09cd09be09ab09d809cf00060007000626fd09bf09aa09d809cf00060007000626fd00010001137a139509bf09ab09d809cf00060007000626fd000100011379139600010ce30d0e0d1f09e109c109b709b809e309be09b609b9000500050005270109e409bd09b509ba0005000500052701000100011378139709e409bd09b509ba0005000500052701000100011378139700010d010d070d08099009ee09cb09c700060008000626fc00010001136c13a400010d090cfc0d0a09b609d409e509a0";

    function _indexSorted(uint8 a, uint8 b, uint8 c, uint8 d) internal pure returns (uint256 idx) {
        // Rank in nested-loop order without brute-forcing all 715 entries.
        // Count of nondecreasing length-r sequences from [s..10] is C((10-s+1)+r-1, r).
        if (a < 1 || d > 10) revert("ReadinessWinProbTable: bad tuple");
        if (a > b || b > c || c > d) revert("ReadinessWinProbTable: bad tuple");

        for (uint8 i = 1; i < a; i++) {
            idx += _c3(uint8(13 - i)); // C((10-i)+3,3) = C(13-i,3)
        }
        for (uint8 j = a; j < b; j++) {
            idx += _c2(uint8(12 - j)); // C(12-j,2)
        }
        for (uint8 k = b; k < c; k++) {
            idx += uint256(11 - k); // C(11-k,1)
        }
        idx += uint256(d - c); // C(_,0)
    }

    function _c2(uint8 n) private pure returns (uint256) {
        if (n < 2) return 0;
        return (uint256(n) * uint256(n - 1)) / 2;
    }

    function _c3(uint8 n) private pure returns (uint256) {
        if (n < 3) return 0;
        return (uint256(n) * uint256(n - 1) * uint256(n - 2)) / 6;
    }

    function getSorted(uint8 a, uint8 b, uint8 c, uint8 d) external pure returns (uint16[4] memory probsBps) {
        uint256 idx = _indexSorted(a, b, c, d);
        uint256 off = idx * ENTRY_BYTES;
        probsBps[0] = _u16be(off);
        probsBps[1] = _u16be(off + 2);
        probsBps[2] = _u16be(off + 4);
        probsBps[3] = _u16be(off + 6);
    }

    function _u16be(uint256 off) private pure returns (uint16 v) {
        // TABLE is a constant bytes, so bounds are guaranteed by construction.
        uint8 hi = uint8(TABLE[off]);
        uint8 lo = uint8(TABLE[off + 1]);
        v = (uint16(hi) << 8) | uint16(lo);
    }
}
